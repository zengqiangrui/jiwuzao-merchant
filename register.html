<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta author="">
		<link rel="stylesheet" type="text/css" href="css/login/register-login.css">
		<link rel="stylesheet" type="text/css" href="dist/css/layui.css" />
		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
		<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
		<script src="dist/layui.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/environment.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/kboot.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/msCode.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			#button{
				background-color: grey
			}
			#button:hover{
				background-color: lightgrey
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div id="box"></div>
			<div class="cent-box register-box">
				<div class="cent-box-header">
					<h1 class="main-title hide">极物造</h1>
				</div>

				<div class="cont-main clearfix">
					<div class="index-tab">
						<div class="index-slide-nav">
							<a href="login.html" style="color: white;font-weight: 600;">登录</a>
							<a href="register.html" class="active">注册</a>
							<div class="slide-bar slide-bar1"></div>
						</div>
					</div>

					<div class="login form">
						<div class="group">
							<div class="group-ipt phone">
								<input type="text" style="color: white;" name="phone" id="phone" class="ipt" maxlength="11"
								 placeholder="手机号" required>
							</div>
							<div class="group-ipt password">
								<input type="password" style="color: white;" name="password" id="password" class="ipt"
								 placeholder="设置登录密码(8-18位数字字母组合)" required>
							</div>
							<div class="group-ipt password1">
								<input type="password" style="color: white;" name="verifyPwd" id="verifyPwd" class="ipt"
								 placeholder="重复密码" required>
							</div>
							<div class="group-ipt verify">
								<input type="text" style="color: white;" name="verifyCode" id="verifyCode" class="ipt" placeholder="输入验证码"
								 required>
								<!-- <img src="http://zrong.me/home/index/imgcode?id=" class="imgcode"> -->
								<button id='veifyBtn' class="layui-btn-primary imgcode" :disabled="verifyDisabled" @click.prevent="getVerifyCode">{{verifyMsg}}</button>
							</div>
						</div>
					</div>
					<!-- <label class="remember-me"><span class="icon"><span class="zt"></span></span><input type="checkbox" name="remember-me"
						 id="remember-me" class="remember-mecheck" checked></label> -->
					<div class="layui-form">
						<div class="layui-input-inline" style="margin:10px 0 0 10px;">
							<input style="transform: scale(0.6);" type="checkbox" name="agreeCheck" id="agreeCheck" /><label for="agreeCheck"><a
								 style="font-size: 13px; color: blue;" href="pages/agreement/user-agreement.html">《极物造用户服务协议
									极物造隐私条款》</a></label>
						</div>

					</div>

					<div class="button">
						<button type="submit" onclick="register()" class="login-btn register-btn" id="button">注册</button>
					</div>
				</div>
			</div>

			<div class="footer">
				<div style="width: 100%; text-align: center;">
					<p style="color: #EEEEEE;font-size: 10px;"><a style="color: #EEEEEE;font-size: 10px;" href="http://www.miitbeian.gov.cn">渝ICP备18017599号
						</a>©2019 重庆懿妈荟科技发展有限公司 版权所有</p>
				</div>
			</div>
		</div>
		<script src='js/login/particles.js' type="text/javascript"></script>
		<script src='js/login/background.js' type="text/javascript"></script>
		<script src='dist/lay/modules/layer.js' type="text/javascript"></script>
		<script>
			$('.imgcode').hover(function() {
				layer.tips("看不清？点击更换", '.verify', {
					time: 6000,
					tips: [2, "#eee"]
				})
			}, function() {
				layer.closeAll('tips');
			})

			var example = {
				phone: "",
				password: "",
				verifyPwd: "",
				verifyCode: "",
				// agreeCheck:null,
			}
			
			function register() {
				var n = document.getElementById("agreeCheck").checked;
				if (!n) {
					layer.msg("请认真阅读并勾选")
					return false
				}
				var phone = $("#phone").val()
				if (!/^[1][0-9]{10}$/.test(phone)) {
					layer.msg("请输入正确的手机号")
					return false
				}
				var password = $("#password").val()
				var verifyPwd = $("#verifyPwd").val()
				if (password !== verifyPwd) {
					layer.msg("两次输入密码不一样")
					return false
				}
				var verifyCode = $("#verifyCode").val()
				if (!verifyCode) {
					layer.msg("请输入验证码")
					return false
				}
				var request = post(true, major + "/userBasic/register", {
					"phone": phone,
					"pwd": password,
					"msCode": verifyCode
				})
				handleRequest(request, function(res) {
					var flag = false
					if (res.state == 'success') {
						flag = true
					}
					if (res.msg == "已注册")
						flag = true
					if (flag) {
						layer.msg('请登录')
						location.href = "login.html"
					}
				})
			}
			
			new Vue({
				el:"#veifyBtn",
				data(){
					return {
						verifyMsg: "获取验证码",
						verifyDisabled: false,
					}
				},
				methods:{
					getVerifyCode() {
						if (!/^[1][0-9]{10}$/.test($("#phone").val())) {
							layer.msg("请输入正确的手机号")
							return false
						}
						sendSmsCode($("#phone").val())
						var second = 60
						this.verifyDisabled = true
						this.verifyMsg = "剩余" + second
						var interval = setInterval(() => {
							this.verifyMsg = "剩余" + --second + "秒"
							if (second == 0) {
								this.verifyDisabled = false,
									this.verifyMsg = "获取验证码"
							}
						}, 1000)
						setTimeout(() => {
							clearInterval(interval)
						}, 60010)
					}
				}
			})
			
		</script>
	</body>
</html>

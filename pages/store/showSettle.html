<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			button {
				display: inline-block;
				padding: 6px 12px;
				font-size: 14px;
				line-height: 1.42857143;
				text-align: center;
				cursor: pointer;
				border: 1px solid transparent;
				border-radius: 4px;
				color: #fff;
				background-color: #5bc0de;
			}

			.layui-form-label {
				width: 200px;
			}

			.main {
				width: 1000px;
				margin: 100px auto;
			}

			#step {
				margin-bottom: 60px;
			}

			.btns {
				display: flex;
				align-items: center;
				justify-content: flex-end;
			}

			.info {
				float: left;
				height: 34px;
				line-height: 34px;
				margin-left: 40px;
				font-size: 28px;
				font-weight: bold;
				color: #928787;
			}

			.info span {
				color: red;
			}

			#app {
				padding: 20px 100px;
			}

			#need-know {
				font-size: 20px;
			}

			#verify-name {
				width: 100%;
			}

			.idcard-area {
				width: 270px;
				height: 180px;
				display: flex;
				align-items: center;
				justify-content: center;
				border: 4px dashed #272636;
				border-radius: 10px;
				margin-bottom: 10px;
			}

			.idcard-area:hover {
				background: #E8E8E8;
			}

			.idcard-area img {
				width: 100%;
				height: 100%;
				cursor: pointer;
			}

			.div-add {
				width: 100%;
				height: 100%;
				background: url(/jiwuzao-merchant/img/icons/add.png) no-repeat center;
				background-size: 60px 60px;
			}

			.img-add {
				width: 100px;
				height: 100px;
			}

			.redStar {
				color: red;
				font-size: 1.5rem;
			}
		</style>
		<link rel="stylesheet" type="text/css" href="../../css/store/jquery.step.css" />
		<link rel="stylesheet" type="text/css" href="../../dist/css/layui.css" />
		<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
		<script src="../../js/environment.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/store/jquery.step.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../dist/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/kboot.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
		<script src="https://unpkg.com/http-vue-loader"></script>

	</head>

	<body>
		<div id="app">
			<!-- <div id="step" style="width: 100%;"></div> -->
			<div id="need-know" >
				<div id="agreement">
					<iframe src="../agreement/merchant-agreement.html" width="100%" height="1000" disabled></iframe>
				</div>
				<div style="display: flex;align-items: center;justify-content: center ; height: 50px;width: 100%;"><input id="needknow"
					 style="zoom: 200%;" :checked="needKnow" disabled="true" type="checkbox" name="admit" value="admit" /><label for="needknow">我已仔细阅读并同意</label></div>
			</div>
			<div id="verify-name">
				<form class="layui-form" action="">
					<div class="layui-form-item">
						<label class="layui-form-label">真实姓名<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="trueName" maxlength="6" :disabled="disabled" :value="example.trueName" required
							 lay-verify="name" placeholder="请输入真实姓名" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">身份证号码<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="idcard" :disabled="disabled" :value="example.idcard" required lay-verify="idcard"
							 placeholder="请输入身份证号" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">身份信息<span class="redStar">*</span></label>
						<!--图片输入，身份证正面，背面，手持-->
						<img-area :imgs="idcards" />
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">公司名称<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="companyName" :disabled="disabled" :value="example.companyName" required lay-verify="companyName"
							 placeholder="请输入公司名称" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">开户名称<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="bankTrueName" :disabled="disabled" :value="example.bankTrueName" required lay-verify="name"
							 placeholder="请输入开户名称" autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">开户银行<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="openingBank" :disabled="disabled" :value="example.openingBank" required placeholder="开户银行"
							 autocomplete="off" class="layui-input">
							<!--开户行-->
							<!-- <select name="openingBank" :disabled="disabled" :value="example.openingBank">
								<option value="">请选择开户行</option>
								<option value="ICBC">工商银行</option>
								<option value="ABC">农业银行</option>
								<option value="BOC">中国银行</option>
								<option value="CCB">建设银行</option>
								<option value="CMB">招商银行</option>
								<option value="PSBC">邮储银行</option>
								<option value="BCM">交通银行</option>
								<option value="SPDB">浦发银行</option>
								<option value="CMBC">民生银行</option>
								<option value="CIB">兴业银行</option>
								<option value="PABC">平安银行</option>
								<option value="CNCB">中信银行</option>
								<option value="HXB">华夏银行</option>
								<option value="CGB">广发银行</option>
								<option value="CEB">光大银行</option>
								<option value="BOB">北京银行</option>
								<option value="NBCB">宁波银行</option>
								<option value="BOSC">上海银行</option>
							</select> -->
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">银行账号<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="number" name="bankNo" :disabled="disabled" :value="example.bankNo" required lay-verify="required"
							 placeholder="请输入银行账号" autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">统一社会信用代码<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<input type="text" name="uscc" :disabled="disabled" :value="example.uscc" required lay-verify="uscc" placeholder="请输入统一社会信用代码"
							 autocomplete="off" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">营业执照<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<img-area :imgs="businessLicense" />
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">银行开户许可证<span class="redStar">*</span></label>
						<div class="layui-input-block">
							<img-area :imgs="accountOpenLicence" />
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-card">
							<div class="layui-card-header" id='otherVerify'>其他认证信息</div>
						</div>
						<img-area :imgs="otherImgs" />
					</div>

				<!-- 	<div class="layui-form-item">
						<div class="layui-input-block">
							<button class="layui-btn layui-btn-warm" :disabled="disabled" lay-submit lay-filter="form">立即提交</button>
						</div>
					</div> -->
				</form>
			</div>
			<!-- <div id="" v-show="example.stepData.index==2">
			</div>
			<div id="" v-show="example.stepData.index==3">
				{{verifyMsg}}
			</div>
			<div class="btns">
				<button id="prevBtn" v-show="example.stepData.index>0" class="layui-btn layui-btn-normal" @click="prev">上一步</button>
				<button id="nextBtn" class="layui-btn layui-btn-normal" @click="next">下一步</button>
			</div> -->
		</div>
	</body>
	<script type="text/javascript">
		$(function() {
			$('#otherVerify').hover(function() {
				layer.tips("食品安全认证等", '#otherVerify')
			}, function() {
				layer.closeAll('tips');
			})

		})
	</script>
	<script type="text/javascript">
		var example = {
			needKnow: false,
			verifyMsg: "",
			show: true,
			disabled: false,
			merchant: null,
			trueName: "",
			idcard: "",
			bankNo: "",
			bankTrueName: "",
			openingBank: "",
			companyName: "",
			uscc: "",
			tipsShow: false,
			selected: "",
			stepData: {
				index: 0,
				time: 400,
				title: ["阅读须知", "入驻认证", "保证金", "认证状态"]
			},
			businessLicense: [{
				url: "",
				msg: "营业执照",
				showDelete: true,
				style: {
					"width": "500px",
					"height": "800px",
					"padding": "5px",
					"font-size": "20px"
				}
			}],
			accountOpenLicence: [{
				url: "",
				msg: "开户许可证",
				showDelete: true,
				style: {
					"width": "500px",
					"height": "800px",
					"padding": "5px",
					"font-size": "20px"
				}
			}],
			idcards: [{
				url: "",
				msg: "身份证正面",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}, {
				url: "",
				msg: "身份证背面",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}, {
				url: "",
				msg: "手持身份证",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}],
			otherImgs: [{
				url: "",
				msg: "其他图1",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}, {
				url: "",
				msg: "其他图2",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}, {
				url: "",
				msg: "其他图3",
				showDelete: true,
				style: {
					"width": "270px",
					"height": "180px",
					"padding": "5px"
				}
			}]
		}

		function checkImgs() {
			var list = example.idcards
			var list2 = example.businessLicense
			var item = list.concat(list2).concat(example.accountOpenLicence)
			var flag = true
			item.forEach(e => {
				if (!e.url) {
					flag = false
					return false
				}
			})
			if (!flag) {
				layer.msg("必要图片必须上传")
			}
			return flag
		}

		function getOtherImgs(item) {
			var str = ""
			item.forEach(res => {
				str = str + res.url + ","
			})
			return str
		}

		var vm = new Vue({
			el: "#app",
			data() {
				return example;
			},
			components: {
				'img-area': httpVueLoader('/jiwuzao-merchant/plugins/imgArea.vue'),
			},
			mounted(e) {
				console.log('settle....e',e);
				var request = post(true, major + "/merchant/getVerifyActor", {})
				handleRequest(request, function(res) {
					var merchant = res.data
					example.merchant = merchant
					if (merchant) {
						switch (merchant.auditType) {
							case "refuse":
								example.verifyMsg = "上次提交已被拒绝"
								break;
							case "wait":
								example.verifyMsg = "审核中，请等待"
								break;
							case "agree":
								example.verifyMsg = "恭喜成为极物造匠人"
								// location.href = '../goods/show.html'
								break;
							default:
								break;
						}
					} else {
						example.verifyMsg = "请前往认证吧";
					}

					if (merchant && merchant.auditType != 'refuse') {
						example.needKnow = true
						example.trueName = merchant.trueName
						example.idcard = merchant.idcard
						example.bankNo = merchant.bankNo
						example.bankTrueName = merchant.bankTrueName
						example.openingBank = merchant.openingBank
						example.companyName = merchant.companyName
						example.uscc = merchant.uscc
						example.selected = merchant.openingBank
						example.disabled = true
						example.test = true
						example.idcards[0].url = merchant.frontIdCardPhoto
						example.idcards[1].url = merchant.backIdCardPhoto
						example.idcards[2].url = merchant.handIdCardPhoto
						example.businessLicense[0].url = merchant.businessLicense
						example.businessLicense[0].showDelete = false
						example.accountOpenLicence[0].url = merchant.accountOpenLicence
						example.accountOpenLicence[0].showDelete = false
						for (let i = 0; i < example.idcards.length; i++) {
							example.idcards[i].showDelete = false
						}
						var others = merchant.otherSupportPhotos
						var list = others.split(",")
						console.log(list)
						for (let i = 0; i < list.length; i++) {
							if (!list[i]) {
								example.otherImgs.splice(i)
								break
							}
							example.otherImgs[i].url = list[i]
							example.otherImgs[i].showDelete = false
						}
					}
				})
			},
			methods: {
				addImg(res) {
					var type = res.srcElement.dataset.type
					uploadImg(function(url) {
						switch (type) {
							case "front":
								example.idcard.front = url
								break;
							case "back":
								example.idcard.back = url
								break;
							case "handle":
								example.idcard.handle = url
							default:
								break;
						}
					})
				},

				showSelect: function() {
					console.log(example.openingBank)
				},

				prev() {
					$step.prevStep();
					example.stepData.index = $step.getIndex()
				},
				next() {
					switch ($step.getIndex()) {
						case 0:
							if (!$("#needknow").prop("checked")) {
								layer.msg("请认真阅读并勾选")
								return false
							} else {
								break;
							}
						case 1:
							if (!example.merchant) {
								console.log("nomerchant")
								layer.msg("请认真填写信息并提交")
								return false
							}
							break;
						case 3:
							console.log('step3', example.merchant.auditType)
							if(example.merchant.auditType=='agree'){
								location.href="../store/detail.html"
							}else{
								layer.msg('请耐心等待审核')
								return false
							}
							break;
						default:
							break;
					}
					$step.nextStep();
					example.stepData.index = $step.getIndex()
				}
			}
		})
		var $step = $("#step");
		$step.step(example.stepData);
	</script>
	<script>
		layui.use('form', function() {
			var form = layui.form;
			form.on('submit()', function(data) {
				var formData = data.field
				if (!checkImgs()) {
					return false
				}
				formData.frontIdCardPhoto = example.idcards[0].url
				formData.backIdCardPhoto = example.idcards[1].url
				formData.handIdCardPhoto = example.idcards[2].url
				formData.businessLicense = example.businessLicense[0].url
				formData.accountOpenLicence = example.accountOpenLicence[0].url
				formData.otherSupportPhotos = getOtherImgs(example.otherImgs)
				console.log(JSON.stringify(formData))

				var request = post(true, major + "/merchant/verifyActor", formData)
				handleRequest(request, function(res) {
					if (res.state == 'success') {
						example.merchant = formData
						// location.href = 'settle.html'
					}
				})
				return false;
			});
			form.render()
		});
	</script>
</html>

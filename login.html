<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>登录 - 极物造</title>
		<link rel="stylesheet" type="text/css" href="dist/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="css/login/register-login.css">
		<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
		<script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
		<script src="dist/layui.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/environment.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			#button{
				background-color: grey
			}
			#button:hover{
				background-color: lightgrey
			}
		</style>
	</head>
	<body>
		<div id="app">

			<div id="box"></div>
			<div class="cent-box">
				<div class="cent-box-header">
					<h1 class="main-title hide">极物造</h1>
				</div>

				<div class="cont-main clearfix">
					<div class="index-tab">
						<div class="index-slide-nav">
							<a href="login.html" class="active">登录</a>
							<a href="register.html" style="color: white;font-weight: 600;">注册</a>
							<div class="slide-bar"></div>
						</div>
					</div>

					<div class="login form">
						<div class="group">
							<div class="group-ipt phone">
								<input type="text" style="color: white;" name="phone" v-model="phone" id="phone" class="ipt" placeholder="手机号"
								 required>
							</div>
							<div class="group-ipt password">
								<input type="password" style="color: white;" name="password" v-model="pwd" id="password" class="ipt"
								 placeholder="输入您的登录密码" required>
							</div>
							<div class="group-ipt verify">
								<input type="text" style="color: white;" name="verify" id="verify" v-model="verifyCode" class="ipt" placeholder="输入验证码"
								 required>
								<!-- <button class="imgcode layui-btn-primary">获取验证码</button> -->
								<canvas id="canvas" class="imgcode" @click="changeVerify" width="120" height="50"></canvas>
							</div>
						</div>
					</div>
					<div class="button">
						<button type="submit" @click="login" class="login-register-btn" id="button">登录</button>
					</div>
					<!-- 				<div class="login form">
					<div class="group">
						<div class="group-ipt phone">
							<input type="text" name="phone" id="phone" class="ipt" placeholder="手机号" required>
						</div>
						<div class="group-ipt password">
							<input type="password" name="password" id="password" class="ipt" placeholder="输入您的登录密码" required>
						</div>
						<div class="group-ipt verify">
							<input type="text" name="verify" id="verify" class="ipt" placeholder="输入验证码" required>
							<button class="imgcode layui-btn-primary">获取验证码</button>
						</div>
					</div>
				</div> -->

					<div class="remember clearfix">
						<label class="forgot-password">
							<a href="#">忘记密码？</a>
						</label>
					</div>
				</div>
			</div>

			<div class="footer">
				<div style="width: 100%; text-align: center;">
					<p style="color: #EEEEEE;font-size: 10px;"><a style="color: #EEEEEE;font-size: 10px;" href="http://www.miitbeian.gov.cn">渝ICP备18017599号
						</a>©2019 重庆懿妈荟科技发展有限公司 版权所有</p>
				</div>
			</div>
		</div>
		<script src='js/login/particles.js' type="text/javascript"></script>
		<script src='js/login/background.js' type="text/javascript"></script>
		<script src='js/login/jquery.min.js' type="text/javascript"></script>
		<script src='dist/lay/modules/layer.js' type="text/javascript"></script>
		<script src="js/util/verifyCode.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/util/sha256.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/kboot.js" type="text/javascript" charset="utf-8"></script>
		<script>
			$('.imgcode').hover(function() {
				layer.tips("看不清？点击更换", '.verify', {
					time: 6000,
					tips: [2, "#eee"]
				})
			}, function() {
				layer.closeAll('tips');
			});
			$("#remember-me").click(function() {
				var n = document.getElementById("remember-me").checked;
				if (n) {
					$(".zt").show();
				} else {
					$(".zt").hide();
				}
			});
			var example = {
				show_num: [],
				phone: "",
				pwd: "",
				verifyCode: ""
			}

			var vm = new Vue({
				el: "#app",
				data() {
					return example
				},
				mounted() {
					draw(example.show_num);
				},
				methods: {
					changeVerify() {
						draw(example.show_num);
					},
					login() {
						console.log('res', this.show_num);
						if (this.verifyCode.toLowerCase() !== this.show_num.join("").toLowerCase()) {
							layer.msg('验证码错误')
							this.changeVerify()
							return false
						}

						if (!/^[1][0-9]{10}$/.test(this.phone)) {
							layer.msg("请输入正确的手机号")
							return false
						}

						if (!/^[a-zA-Z0-9^%&',;=$\x22\(\)\[\]\|\{\}\+\-\*!@#_/<>\.:\?]{8,32}$/.test(example.pwd) ||
							/^[0-9]*[1-9][0-9]*$/.test(
								example.pwd)) {
							layer.msg('密码不符合规则');
							failureMsgLock = true;
							setTimeout(function() {
								failureMsgLock = false;
							}, 1000);
							return
						}
						var request = post(true, major + "/userBasic/login", {
							'phone': example.phone,
							'pwd': example.pwd,
							'sha256': sha256(example.phone + 'login-kboot')
						})
						handleRequest(request, function(result) {
							storageSet('phone', example.phone);
							storageSet('accessToken', result.data, 'd', 7);
							var uid = result.data.split(',')[0]
							var req = post(true, major + "/userBasic/getUserOpenDto", {
								uid
							})
							handleRequest(req, function(res) {
								storageSet('userOpen', res.data, 'd', 7)
								location.href = "index.html";
							})
						})
					}
				}
			})
		</script>
	</body>
</html>
